## アプリケーション名
Rese

## 作成した目的
飲食店予約アプリ
飲食店を紹介して、予約、レビュー、事前決済をする

## URL
- 開発環境：http://localhost/
- phpMyAdmin:：http://localhost:8080/

## 機能一覧
- 飲食店一覧
- 飲食店詳細表示機能
- エリア検索機能
- ジャンル検索機能
- 店名検索機能
- レビュー表示機能
- レビュー機能
- レビュー編集機能
- レビュー削除機能（ユーザー自身）
- レビュー削除機能（管理者）
- 店舗一覧ソート機能
- csvファイルインポートによる新規店舗作成機能
- 会員登録機能（一般ユーザーアカウント）
- ログイン機能
- ログアウト機能
- お気に入り追加機能
- お気に入り削除機能
- 予約機能
- 予約削除機能
- 予約変更機能
- 事前決済機能
- 来店済み確認機能
- 評価機能
- 店舗新規登録機能
- 店舗情報変更機能
- 店舗の予約確認機能
- 管理者による会員登録機能（管理者アカウント・店舗マネージャーアカウント・一般ユーザーアカウント）
- 全アカウントに対する一斉メール送信機能
- リマインダー機能

## 機能補足
##### 店舗詳細画面表示
トップページなどに表示される店舗の写真、名前、タグが書いてあるカードの「詳しく見る」ボタンをクリックで、店舗詳細画面が表示されます  
トップページ以外でも店舗のカードの「詳しく見る」ボタンをクリックすると、店舗詳細画面が表示されます  

##### レビュー機能
userアカウントでログイン Email:sunnychiba@samurai.example Password:password  
店舗詳細画面の左下の「口コミを投稿する」ボタンをクリックし、レビュー投稿ページに移動します  
※ユーザーアカウントでログインしていないと「口コミを投稿する」ボタンは表示されません  
※すでに口コミを投稿している場合も「口コミを投稿する」ボタンは表示されません  
レビュー投稿ページでレート、コメント、画像を入力したのちに、「口コミを投稿」ボタンで、レビューの投稿ができます  
レートは星形のアイコンをクリックで入力できます。左から星1つ評価、一番右が星5つ評価です  
コメントは400文字以内で入力できます  
画像は.jpegファイルもしくは.pngファイルのみアップロード可能です  

##### レビュー編集機能
※レビュー編集機能は、ユーザーアカウントでのレビューを投稿した後に使用できます  
userアカウントでログイン Email:sunnychiba@samurai.example Password:password  
店舗詳細画面の左下の「口コミを編集」ボタンをクリックし、レビュー投稿ページに移動します  
※ユーザーアカウントでログインしていないと「口コミを編集」ボタンは表示されません  
レビュー投稿ページでレート、コメント、画像を編集したのちに、「口コミを編集」ボタンで、レビューの編集ができます  
レートは星形のアイコンをクリックで入力できます。左から星1つ評価、一番右が星5つ評価です  
コメントは400文字以内で入力できます  
画像は.jpegファイルもしくは.pngファイルのみアップロード可能です  

##### レビュー削除機能（ユーザー自身）
※レビュー削除機能は、ユーザーアカウントでのレビューを投稿した後に使用できます  
userアカウントでログイン Email:sunnychiba@samurai.example Password:password  
店舗詳細画面の左下の「口コミを削除」ボタンをクリックすると、確認のポップアップウインドウが表示されます  
※ユーザーアカウントでログインしていないと「口コミを削除」ボタンは表示されません  
ポップアップウインドウの「削除する」をクリックで削除を実行します  

##### レビュー削除機能（管理者）
adminアカウントでログイン Email:k.takakura@poppoya.example Password:password  
ヘッダーの左側にあるハンバーガーメニューをクリックし、ReviewListを選択  
ReviewListページでは全てのレビューが表示されます  
表示されるレビューの右にある「削除」ボタンをクリックすると、確認のポップアップウインドウが表示されます  
ポップアップウインドウの「削除」ボタンをクリックでレビューが削除されます  

##### 店舗一覧画面のソート機能
トップページの上部中央にある「並び替え」と書いてある箇所をクリック  
「ランダム」「評価が高い順」「評価が低い順」の3種類の中から選択できます  
「ランダム」は店舗がランダムに並び替えられます  
「評価が高い順」は各店舗のレビューのレート（星の数）が高い順に並び替えられます。未評価の場合は、最後尾に表示されます  
「評価が低い順」は各店舗のレビューのレート（星の数）が低い順に並び替えられます。未評価の場合は、最後尾に表示されます  

##### csvファイルインポートによる店舗作成機能
adminアカウントでログイン Email:k.takakura@poppoya.example Password:password  
ヘッダーの左側にあるハンバーガーメニューをクリックし、「NewShopCreate」を選択  
csvファイルをインポートする画面に移動するので、csvファイルを選択し、「送信」ボタンをクリックで店舗が作成されます  



###### csvファイルの注意事項
csvファイルで必要な情報は「店舗マネージャーのID」「店舗名」「エリア」「ジャンル」「店舗概要」「画像URL」の6つです  

###### 例）
| 店舗マネージャーのID | 店舗名 | エリア | ジャンル | 店舗概要 | 画像URL |
|---|---|---|---|---|---|
| 1 | 八兵衛 | 福岡県 | 焼肉 | 美味しい焼肉屋さんです。 | image/yakiniku.jpeg |
  
- 店舗マネージャーのID：店舗マネージャーアカウントのIDを半角数字で入力してください。シーディング後、3つのマネージャーアカウントが作られるので、シーディング直後は3までが使用可能です。新しく店舗マネージャーアカウントを作成した場合は、そのアカウントのIDも使用できます
- 店舗名：50文字以内で入力してください  
- エリア：「東京都」「大阪府」「福岡県」のいずれかを入力してください  
- ジャンル：「寿司」「焼肉」「イタリアン」「居酒屋」「ラーメン」のいずれかを入力してください  
- 店舗概要：400文字以内で入力してください  
- 画像URL：.jpegファイルか、.pngファイルのみアップロード可能です  
- ファイル形式は必ず.csvで保存してください  
- CSVファイルのフォーマットは、上記例のフォーマットと一致している必要があります  
- 各列のデータは必須です（空欄は不可）  
- ファイルが不正な形式の場合、インポート処理が失敗する可能性があります  

##### ログイン機能
ログインは、admin・shopManager・userの3つの役割で行える  
シーディング後下記4つのアカウントを使用できます  

admin(管理者)  Email:k.takakura@poppoya.example Password:password  
shopManager(店舗管理者) Email:kitaouji@kinkin.example Password:password  
shopManager(店舗管理者) Email:ishiharapro@example Password:password  
user(一般ユーザー) Email:sunnychiba@samurai.example Password:password  

shopManagerアカウントを2つ用意しています  
店舗新規登録機能の確認はkitaouji@kinkin.exampleアカウントで行なってください  
店舗情報変更機能と店舗の予約確認機能の確認はishiharapro@exampleアカウントで行なってください  
<br>

##### 来店済み確認機能
userアカウントでログイン後、ハンバーガーメニューよりMyPageを選択  
MyPage画面左の予約状況のQRコードを読み取り、画面遷移する  
来店確認画面が表示されるので、はいを選択すれば来店済みになります  
来店済みにすると、MyPageの画面左に表示されていた予約が、画面右の来店済みの方に表示されます  
<br>

##### 店舗新規登録機能
kitaouji@kinkin.exampleアカウントでログイン後、ハンバーガーメニューよりShopManagerを選択  
<br>

##### 店舗情報変更機能
ishiharapro@exampleアカウントでログイン後、ハンバーガーメニューよりShopManagerを選択  
<br>

#####  店舗の予約確認機能
ishiharapro@exampleアカウントでログイン後、ハンバーガーメニューよりShopReserveを選択  
<br>

##### 管理者による会員登録機能
adminアカウントでログイン後、ハンバーガーメニューよりAdminRegisterを選択  
Username Email Password は任意のものを記入  
一番下の欄でAdmin・ShopManager・Userの3つの役割から選択できます  
Userアカウントを作成した場合のみメール認証が必要です  
Userアカウントでログイン後、MyPageに遷移するタイミング、もしくは店舗詳細より予約を行おうとするタイミングで認証画面に遷移します  
認証メールの再送信をして、送信されたメールより認証を行なってください  
<br>

##### 全アカウントに対する一斉メール送信機能
メール送信に時間がかかる場合があるので、送信が完了するまでしばしお待ちください  

## 使用技術(実行環境)
- PHP8.3.3
- Laravel8.83.8
- MySQL8.0.26

## ER図
![alt text](rese.drawio.png)

## 環境構築
**Dockerビルド**
1. `git clone git@github.com:cobaaan/rese2.git`
2. DockerDesktopアプリを立ち上げる
3. `docker-compose up -d --build`

> *MacのM1・M2チップのPCの場合、`no matching manifest for linux/arm64/v8 in the manifest list entries`のメッセージが表示されビルドができないことがあります。
エラーが発生する場合は、docker-compose.ymlファイルの「mysql」内に「platform」の項目を追加で記載してください*
``` bash
mysql:
    platform: linux/x86_64(この文追加)
    image: mysql:8.0.26
    environment:
```

**Laravel環境構築**
1. `docker-compose exec php bash`
2. `composer install`
3. 「.env.example」ファイルを 「.env」ファイルに命名を変更。または、新しく.envファイルを作成
4. .envに以下の環境変数を追加
``` text
DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=laravel_db
DB_USERNAME=laravel_user
DB_PASSWORD=laravel_pass
```

5. アプリケーションキーの作成
``` bash
php artisan key:generate
```

6. マイグレーションの実行
``` bash
php artisan migrate
```

7. シーディングの実行
``` bash
php artisan db:seed
```

8. シンボリックリンクの作成
``` bash
php artisan storage:link
```